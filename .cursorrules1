I’m building FocusTube (YouTube focus extension + backend). Use docs/MVP_SPEC.md as the single source of truth. Work in small, isolated steps. Before any code, state: WHAT will change, WHY, ACCEPTANCE CRITERIA. Then propose the minimal diff. Wait for my “OK” after each step.

Constraints:
	•	Keep rules.js pure; all decisions go there. Background does storage + API calls. Content enforces UI only.
	•	MV3 messaging pattern: one listener, return true, async IIFE inside.
	•	Handle network failures gracefully; fallback to safe defaults.
	•	Add light inline comments; no refactors unless required by the step.

Immediate plan (execute in order, one step at a time):
	1.	Server bootstrap (/server):
	•	TypeScript + Express + dotenv + CORS.
	•	Routes: GET /health, GET /license/verify (stub returns {plan:"trial", days_left:14}), POST /ai/classify (returns static aligned/borderline/distracting for now), POST /events/watch (no-op 200), POST /journal (no-op 200), POST /webhook/stripe (logs only).
	•	.env.example with required keys.
	2.	Extension → /license/verify:
	•	Background fetch on startup and every 6 hours; cache {plan, days_left} in storage (ft_plan, ft_trial_expires_at).
	•	If plan=“trial”, store days_left.
	3.	Trial logic in background:
	•	If days_left <= 0 → treat as free.
	•	Expose FT_GET_STATUS message → returns {plan, days_left}.
	4.	AI classify wire:
	•	Background exposes classifyVideo(meta) that POSTs /ai/classify and caches result in storage by {video_id, date} for 24h.
	•	Content calls background after ≥90s watch to classify asynchronously (do not block playback).
	5.	Counters + rotation:
	•	Ensure daily rotation of counters + shorts minutes + watch seconds; midnight local.
	6.	Content overlays (MVP):
	•	Shorts: Free → redirect home + full overlay. Pro → minutes tracked with reminders at 2,5,10; then block for day.
	•	Daily limit: Free 60m, Pro default 90m (configurable later). Soft overlay at 50/75/90/100%.
	7.	Events piping:
	•	Background batches watch sessions to POST /events/watch every N minutes (N=15 for MVP) and on unload.
	8.	Journal stub:
	•	Overlay button “Add note” → background → POST /journal.
	9.	Replace classify stub with real OpenAI in /server/src/aiClassify.ts using the prompt spec in MVP_SPEC. Cache per (user_id, video_id) for 24h.

At each step, show EXACT files changed and minimal diffs. Do not touch unrelated files.


I am working with lovable and lovable cloud as well.