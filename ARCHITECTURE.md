# FocusTube Architecture

## Overview

FocusTube consists of three main components that work together:

1. **Frontend Website** - User-facing web application
2. **Backend API Server** - Handles business logic, AI, and data
3. **Chrome Extension** - Monitors YouTube and enforces rules

---

## Component Details

### 1. Frontend Website

**Build Tool:** Lovable (visual drag-and-drop editor)
- Fast UI development
- Visual editing
- Auto-syncs to Git

**Hosting:** Vercel
- Automatic deployment from Git
- Free tier available
- Fast CDN
- Custom domains

**Flow:**
```
Lovable (build) → Git → Vercel (host) → Live Site
```

**Pages:**
- Landing page (`/`)
- Signup/Auth (`/signup`)
- Download (`/download`)
- Dashboard (`/dashboard`) - Pro only
- Settings (`/settings`)

**Tech Stack:**
- React/Next.js (generated by Lovable)
- Supabase Auth (for login)
- API calls to backend

---

### 2. Backend API Server

**Hosting:** Railway or Render
- Auto-deploys from Git
- Free tier available
- Environment variables management

**Flow:**
```
Git → Railway/Render → Live API
```

**Tech Stack:**
- Node.js + Express
- TypeScript
- Supabase (database)
- OpenAI (AI classification)
- Stripe (payments)

**Endpoints:**
- `GET /health` - Health check
- `GET /license/verify?email=` - Get user plan
- `POST /ai/classify` - Classify video content
- `POST /events/watch` - Log watch sessions
- `POST /journal` - Save journal entries
- `POST /stripe/create-checkout` - Create Stripe checkout
- `POST /webhook/stripe` - Handle Stripe webhooks
- `POST /auth/signup` - Create user (to be added)
- `GET /dashboard/stats` - Get dashboard data (to be added)

---

### 3. Chrome Extension

**Hosting:** Chrome Web Store
- Published extension
- Auto-updates for users

**Tech Stack:**
- Chrome Manifest V3
- JavaScript (ES modules)
- Chrome Storage API
- Chrome Runtime API

**Components:**
- `background.js` - Core logic, API calls
- `content.js` - DOM manipulation, overlays
- `rules.js` - Pure decision logic
- `state.js` - Storage management

**Flow:**
```
Extension → Backend API (Railway/Render) → Response
```

---

## Data Flow

### User Signup Flow
```
1. User visits frontend (Vercel)
2. Signs up → Frontend calls Supabase Auth
3. Frontend calls Backend API → Create user record
4. User downloads extension
5. Extension syncs plan from Backend API
```

### Video Classification Flow
```
1. User watches YouTube video
2. Extension detects video (content.js)
3. Extension sends metadata to Backend API
4. Backend calls OpenAI → Classify video
5. Backend stores result in Supabase
6. Backend returns classification to Extension
7. Extension enforces rules (block/allow)
```

### Dashboard Data Flow
```
1. User visits dashboard (Vercel)
2. Frontend calls Backend API → Get stats
3. Backend queries Supabase → Aggregate data
4. Backend returns stats to Frontend
5. Frontend displays charts/graphs
```

---

## Environment Variables

### Frontend (Vercel)
```env
VITE_BACKEND_URL=https://your-backend.railway.app
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
VITE_STRIPE_PUBLISHABLE_KEY=pk_live_...
```

### Backend (Railway/Render)
```env
PORT=3000
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
OPENAI_API_KEY=sk-...
STRIPE_SECRET_KEY=sk_live_...
STRIPE_WEBHOOK_SECRET=whsec_...
STRIPE_PRICE_MONTHLY=price_...
STRIPE_PRICE_ANNUAL=price_...
STRIPE_PRICE_LIFETIME=price_...
```

### Extension
- No environment variables needed
- Uses `chrome.storage.local` for configuration
- Backend URL can be set via storage or hardcoded

---

## Deployment Architecture

```
┌─────────────────┐
│   Lovable       │  Build frontend (visual editor)
│   (Build)       │  → Auto-syncs to Git
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   Git           │  Stores all code
│   (GitHub)      │
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
    ▼         ▼
┌─────────┐ ┌──────────┐
│ Vercel  │ │ Railway/ │
│(Frontend│ │ Render   │
│  Host)  │ │(Backend  │
│         │ │  Host)   │
└─────────┘ └──────────┘
    │            │
    │            │
    └─────┬──────┘
          │
          ▼
    ┌──────────┐
    │Extension │  Calls backend API
    │(Chrome)  │  (Railway/Render URL)
    └──────────┘
```

---

## Key Decisions

### Why Lovable for Frontend?
- Fast development for non-coders
- Visual editor
- Can export code anytime
- No lock-in

### Why Vercel for Frontend Hosting?
- Made by Vercel (industry standard)
- Free tier
- Auto-deploys from Git
- Fast CDN
- Easy custom domains

### Why Railway/Render for Backend?
- Simple deployment
- Free tier available
- Auto-deploys from Git
- Environment variables management
- Good for Node.js/Express

### Why Separate Frontend and Backend?
- Frontend = static files (Vercel optimized)
- Backend = API server (Railway/Render optimized)
- Can scale independently
- Better security (API keys on backend only)

---

## Security

### API Keys
- ✅ All API keys stored on backend (Railway/Render)
- ✅ Extension never sees API keys
- ✅ Frontend only gets public keys (Stripe publishable)

### Authentication
- ✅ Supabase Auth for user login
- ✅ Backend validates all requests
- ✅ Extension uses email-based auth (for now)

### CORS
- ✅ Backend allows Chrome extension origins
- ✅ Backend allows frontend domain (Vercel)
- ✅ Configured in `server/src/index.ts`

---

## Cost Estimate (Free Tier)

| Service | Cost | Limits |
|---------|------|--------|
| **Vercel** | Free | Generous limits |
| **Railway** | Free tier | Limited hours/month |
| **Render** | Free tier | Sleeps after inactivity |
| **Supabase** | Free tier | 500MB database, 2GB bandwidth |
| **OpenAI** | Pay per use | ~$0.002 per classification |
| **Stripe** | Free | Takes % of payments |

**Total:** ~$0/month until you scale (then ~$10-20/month)

---

## Next Steps

1. Build frontend in Lovable
2. Connect Lovable to Git
3. Deploy frontend to Vercel
4. Deploy backend to Railway/Render
5. Update extension with production URLs
6. Test end-to-end
7. Publish extension to Chrome Web Store


